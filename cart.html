<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">السلة</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>




</head>

<script>
  function getQueryParams(qs) {
      qs = qs.split('+').join(' ');

        var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

         while (tokens = re.exec(qs)) {
             params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
         }

       return params;
      }

      var query = getQueryParams(document.location.search);

      var index = query.index;
      var from = query.from;

</script>


<body>
    <style>
        body{
    margin-top:20px;
    background:#eee;
}
.ui-w-40 {
    width: 40px !important;
    height: auto;
}

.card{
    box-shadow: 0 1px 15px 1px rgba(52,40,104,.08);    
}

.ui-product-color {
    display: inline-block;
    overflow: hidden;
    margin: .144em;
    width: .875rem;
    height: .875rem;
    border-radius: 10rem;
    -webkit-box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset;
    box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset;
    vertical-align: middle;
}
    </style>
    <div class="container px-3 my-5 clearfix">
        <!-- Shopping cart table -->
        <div class="card">
            <div class="card-header">
                <h2 dir="rtl">سلـة العميـل</h2>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-bordered m-0">
                    <thead>
                      <tr>
                        <!-- Set columns width -->
                        <th class="text-center py-3 px-4" >الصوره</th>
                        <th class="text-center py-3 px-4" >الصنف</th>
                        <th class="text-right py-3 px-4" >السعر</th>
                        <th class="text-center py-3 px-4" >العدد</th>
                        <!-- <th class="text-right py-3 px-4" >المجموع</th> -->
                        <!-- <th class="text-center align-middle py-3 px-0" style="width: 40px;"><a href="#" class="shop-tooltip float-none text-light" title="" data-original-title="Clear cart"><i class="ino ion-md-trash"></i></a></th> -->
                      </tr>
                    </thead>
                    <tbody id="mybody">
            
                      <!-- <tr>
                        <td class="p-4">
                          <div class="media align-items-center">
                            <div class="media-body">
                              <a href="#" class="d-block text-dark">حلا</a>
                              <small>
                                <span class="text-muted">جبن</span>
                                <span class="text-muted">بق تيستي </span> 
                                <span class="text-muted"> كاتشب </span> 
                              </small>
                            </div>
                          </div>
                        </td>
                        <td class="text-right font-weight-semibold align-middle p-4">$57.55</td>
                        <td class="align-middle p-4">2</td>
                        <td class="text-center align-middle px-0"><a href="#" class="shop-tooltip close float-none text-danger" title="" data-original-title="Remove">×</a></td>
                      </tr> -->
            
                     
                    </tbody>
                  </table>
                </div>
                <!-- / Shopping cart table -->
            
                <div class="d-flex flex-wrap justify-content-between align-items-center pb-4">
               
                  <div class="d-flex">
    
                    <div class="text-right mt-4">
                      <label class="text-muted font-weight-normal m-0">المجموع</label>
                      <div class="text-large"><strong id="strong">ر.س</strong></div>
                    </div>
                  </div>
                </div>


                <div class="d-flex flex-wrap justify-content-between align-items-center pb-4">
               
                  <div class="d-flex">
    
                    <div class="text-right mt-4">
                      <label class="text-muted font-weight-normal m-0">طريقة الاستلام</label>
                      <hr>
                      <div class="containerCarSize">
                        <img width="200" height="200" id="carSizeImg" src="" alt="Centered Image" class="containerCarSize">
                    </div>

                    </div>
                  </div>
                </div>



                <div class="d-flex flex-wrap justify-content-between align-items-center pb-4">
               
                  <div class="d-flex">
    
                    <div class="text-right mt-4">
                      <label class="text-muted font-weight-normal m-0">تاريخ الطلب</label>
                      <div class="text-large"><strong id="date"></strong></div>
                    </div>
                  </div>
                </div>




            
                <div class="float-right">
                  <button type="button" id="back" class="btn btn-lg btn-default md-btn-flat mt-2 mr-3">رجوع</button>
                  <!-- <button onclick="done()" class="btn btn-lg mt-2" id="make">تنفيذ</button> -->
                </div>
            
              </div>
          </div>
      </div>

      <style>
        .containerCarSize {
          text-align: center;
          max-width: 100%;
        }
      
        .imgCarSize {
          max-width: 100%;
          max-height: 100%;
        }
      </style>

      <script>


  function timestampToDate(timestamp) {
    // Create a new Date object using the timestamp
    const date = new Date(timestamp);

    // Get the components of the date
    const year = date.getFullYear();
    const month = date.getMonth() + 1; // Month is 0-based, so add 1
    const day = date.getDate();
    const hours = date.getHours();
    const minutes = date.getMinutes();
    const seconds = date.getSeconds();

    // Format the date as a string
    const formattedDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')} ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

    return formattedDate;
  }





        var back = document.getElementById('back');
        id = localStorage.getItem('id');

        back.onclick = (e)=>{

          window.parent.postMessage('back', '*');

          if (from == 'oldorders') {
         
            var order = localStorage.getItem("oldorder");

            window.location = 'oldorders.html';

          }
            
        }

        var order;

        if (from == 'orders') {
             order = localStorage.getItem("order");
          }else{
             order = localStorage.getItem("oldorder");

          }


        

        if (order != null ) {


          
            let orderarr = JSON.parse(order);
            let formalarr = orderarr[index]['order'];
            var total = 0;

            var sizes = [
            "d.png",
            "p.png",
          ];

          var size = orderarr[0].size;
          console.log(formalarr)
          console.log(size);
            var sizenum = parseInt(size);
            if (sizenum == null) {
              sizenum = 3;
            }

            CarSize = sizes[sizenum];

            document.getElementById('carSizeImg').src = CarSize;



          // Example usage:
          const timestamp = orderarr[0].date; // Replace this with your timestamp
          const formattedDate = timestampToDate(timestamp);
          console.log(formattedDate);




            for (let index = 0; index < formalarr.length; index++) {
              
              var pricewithaddon = formalarr[index].price + formalarr[index].addonprice ;
              total = total + (pricewithaddon * formalarr[index].quantity);
              var html =  '<tr> <td class="p-4"> <div class="item2"><img class="img-fluid"  alt="Image" style="border-radius: 15px; float:right" width="130" height="130" src="'+formalarr[index].imgsrcfrontend+'" alt="" id="frontimg"></div> </td> <td class="p-4">  <div class="media align-items-center">  <div class="media-body">  <a href="#" class="d-block text-dark">'+formalarr[index].name+'</a> <small>  <span class="text-muted">'+formalarr[index].addonname+'</span></small></div></div></td><td class="text-right font-weight-semibold align-middle p-4">'+pricewithaddon  +'</td><td class="align-middle p-4">'+formalarr[index].quantity+'</td> </tr>';
              html = $.parseHTML(html);
              $("#mybody").append(html);

              // if (index == orderarr.length -1 ) {
              //   total = orderarr[index].total;
              // }
           
              
            }
            
            document.getElementById('strong').innerText = total + " ر.س";
            document.getElementById('date').innerText = formattedDate;

        }else{
          // id = localStorage.getItem('id');

          // swal("السلة فارغة", "قم بإضافة طلبك من قائمة الطعام", "warning").then(e=>{
          //   window.location = 'index.html?id='+id;
          // });
           
        }


        // var del = document.getElementById('del');
        // del.onclick = (e)=>{
        //     e.preventDefault();
        //     let orderarr = JSON.parse(order);


        // }

       


        // function done() {
        //   window.location = 'submit.html';
        // }


      </script>
</body>


</html>